<% content_for :title, "#{@user.first_name_with_last_initial}'s Profile" %>
<div id="contact-modal" class="modal fade" style="display: none;">  
  <div class="modal-dialog">
    <div class="modal-content">
      <%= form_for @user.messages.new, remote:true do |f| %>
        <div class="modal-header">  
          <a class="close" data-dismiss="modal">Ã—</a>  
          <h3>Contact <%= @user.first_name_with_last_initial %></h3>  
        </div>  
        <div class="modal-body">  
          <div class="row">
            <%= f.text_field :subject , :placeholder => "Subject",  :class => "form-control"%>
          </div>
          <section class="row" >
            <%= f.text_area :body , :placeholder => "Type your message here...", :rows => "8", :class => "form-control"%>
          </section>               
          <%= f.hidden_field :sender_id, value: "#{current_user.id}" %>
          <%= f.hidden_field :receiver_id, value: "#{@user.id}" %>
        </div>  
        <div class="modal-footer">  
          <%= f.submit "Send", :class => "btn btn-primary btn-lg" %> 
        </div>  
      <% end %>
    </div>
  </div>
</div>

<section class='profile-picture-position col-sm-3'> 
  <% if current_user == @user && !current_user.has_image? %>
    <div class="well">
      <%= form_for(resource, :as => resource_name, :url => registration_path(resource_name), :html => { :method => :put }) do |f| %>
        <div class="field">
          <%= f.label :avatar, "Select Profile Picture" %><br />
          <%= f.file_field :avatar %>
        </div>
        <%= f.submit "Upload", class:"btn btn-success" %>
      <% end %>
    </div>
  <% else %>
    <%= large_profile_picture(@user) %>
  <% end %>
  <div class='text-left large'>
    <br>
    <div>
      <strong>Name:</strong> 
      <%= @user.first_name_with_last_initial %> 
    </div>
    <div>
      <strong><%= @user.bank? ? "Bank" : "Business" %>:</strong>
      <%= @user.org_name %>
    </div>
    
    <div>
      <strong class=''>Position:</strong>
      <span class="muted"><%= @user.position %></span>
    </div>
    <div>
      <strong>Bucks:</strong> 
      <span class="muted"> <%= @user.karma + 100 %></span>
    </div>
    <div>
      <strong class=''>Status:</strong>
      <span class="muted"><%= @user.status %></span>
    </div>
    <div>
      <strong class=''>Percent Match:</strong>
      <span class="muted"><%= current_user.percentage_match(@user) %>% </span>
    </div>
  </div>
  <section class="text-center">
    <% if @user == current_user %>
      <%= link_to edit_profile_path(@user), class:"btn btn-default btn-block btn-lg" do %>
        <i class="icon ion-ios7-person-outline"></i> Edit Profile
      <% end %>
    <% else %>
      <%= render partial: 'follow_form', locals: { user: @user } if user_signed_in? %>
      <a data-toggle="modal" href="#contact-modal" class="btn btn-default btn-lg btn-block"><i class="ion-ios7-email blue"></i> Contact </a>
      <section class="muted large">
        <%= calls_to_action.sample %>
      </section>
    <% end %>
  </section>
  <% if @user.posts.any? %>
  <div class="well gray-border-left text-left">
    <h4><%= @user.first_name_with_last_initial %>'s Interests</h4>    
    <div class="tag-cloud">
      <% @user.posts.each do |p| %>
        <% p.tags.each do |t| %>
          <%= link_to "#{t.name}", post_path(p), class:"tag clickable-tag" %>
        <% end %>
      <% end %>
    </div>
  </div>
  <% end %>
</section>

<div class="col-sm-6 large border-left">
  <div class="row">
    <div class="col-sm-6">
      <h3>Bio</h3>
      <p class="muted"><%= @user.bio %></p>
    </div>
    <div class="col-sm-6">
      <h3>Goals</h3>
      <p class="muted"><%= @user.goals %></p>
    </div>
  </div>
  <% if @user.bank? %>
    <h3>Preferences</h3>
  <% end %>
  <div class='row'>
    <section class="col-sm-6">
      <strong class=''>Business Type:</strong>
      <div class="muted"><%= @user.business_types.map(&:description).join(", ") %></div>
    </section>

    <section class="col-sm-6"> 
      <strong class=''>Employees:</strong>
      <div class="muted"><%= @user.employee_sizes.map(&:description).join(", ") %></div>
    </section>
  </div>
  <div class="row">
    <section class="col-sm-3">
      <strong class=''>Customers</strong>
      <div class="muted"><%= @user.customer_types.map(&:description).join(", ") %></div>
    </section>
    <section class="col-sm-3">
      <strong class=''>AR</strong>
      <div class="muted"><%= @user.accounts_receivables.map(&:description).join(", ") %></div>
    </section>
    <section class="col-sm-6">
      <strong class=''>Revenue Size:</strong>
      <div class="muted"><%= @user.revenue_sizes.map(&:description).join(", ") %></div>
    </section>
  </div>
  <div class="row">
    <section class="col-sm-5">
      <strong class=''>Years Filed Taxes:</strong>
      <div class="muted"><%= @user.ages.map(&:description).join(", ") %></div>
    </section>
    <section class="col-sm-7">
      <strong class=''>Size of Financing</strong>
      <div class="muted"><%= @user.loan_sizes.map(&:description).join(", ") %></div>
    </section>
  </div>
  <div class="row">
    <section class="col-sm-12">
      <strong class=''>Industry:</strong>
      <div class="muted"><%= @user.industries.map(&:description).join(", ") %></div>
    </section>
  </div>
  <div class="row">
    <section class="col-sm-8">
      <strong class=''>Does Business in:</strong>
      <div class="muted"><%= @user.locations.map(&:name).join(", ") %></div>
    </section>
  </div>
  <hr>  
  <% if @user == current_user %>
    <h4>Your Activity <div class="muted small">(private)</div></h4>
    <% @activities.each do |activity| %>
      <div class="activity">
      <%= link_to activity.owner.name, activity.owner if activity.owner %>
      <%= render_activity activity %>
      </div>
    <% end %>
    <%= will_paginate @activities, renderer: BootstrapPagination::Rails %>
  <% end %>
  <hr>  
  <% if @user == current_user %>
    <h4>Your Posts</h4>
  <% else %>
    <h4><%= @user.first_name %>'s Recent Posts</h4>
  <% end %>
  <%= render partial: "posts/post", collection: @posts, as: :post %>
  <%= will_paginate @posts, renderer: BootstrapPagination::Rails %>
</div>
  <%= render 'shared/right_sidebar' %>